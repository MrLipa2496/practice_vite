import{_ as S,c as n,a as f,d as h,b as a,r as g,e as m,v as y,w as D,g as _,h as b,F as k,i as $,f as w,o as r,t as d,j as F,n as V}from"./index-Bwrb5_4_.js";import{H as I,l as L}from"./loader-D2qkesDV.js";import{P as T}from"./Msg-DfQ1Tyd-.js";import{T as M}from"./Toogle-A8qWsdET.js";const P={name:"Statistics",components:{Header:I,Popup:T,Toogle:M},data:function(){return{parent:{formData:{},user:{id:"",auth:""},url:""},loaderImg:L,data:{items:[],types:[],multi:""},date:"",date2:"",loader:1,type:0}},mounted:function(){const t=this.findParent();t&&(this.parent=t),this.parent.user&&!this.parent.user.auth?typeof this.parent.logout=="function"&&this.parent.logout():(this.GetFirstAndLastDate(),this.get())},methods:{findParent(){let t=this.$parent;for(;t;){if(t.url||t.user&&t.user.auth)return t;t=t.$parent}return this.$root&&(this.$root.url||this.$root.user)?this.$root:null},toFormData(t){const e=new FormData;if(!t)return e;for(let i in t)e.append(i,t[i]);return e},GetFirstAndLastDate:function(){var t=new Date().getFullYear(),e=new Date().getMonth(),i=new Date(t,e,2),l=new Date(t,e+1,1);this.date=i.toISOString().substring(0,10),this.date2=l.toISOString().substring(0,10)},get:function(){var t=this;t.parent.formData||(t.parent.formData={});var e=this.toFormData(t.parent.formData);const i=this.parent.user?this.parent.user.id:"";e.append("id",i),e.append("type","user"),this.date!=""&&e.append("date",this.date),this.date2!=""&&e.append("date2",this.date2),this.type!=""&&e.append("type",this.type),t.loader=1;const l=this.parent.url||"",u=this.parent.user?this.parent.user.auth:"";if(!l){t.loader=0;return}w.post(l+"/site/getStatistics?auth="+u,e).then(function(o){t.loader=0,t.data=o.data,o.data.types&&o.data.types[0]&&!t.type&&(t.type=o.data.types[0].id),t.parent.formData&&(t.parent.formData.copy=t.data.multi)}).catch(function(o){console.error(o),t.parent.logout&&t.parent.logout(),t.loader=0})},actionStatistic:function(){var t=this,e=this.toFormData(t.parent.formData);const i=this.parent.user?this.parent.user.id:"";e.append("uid",i);const l=this.parent.url||"",u=this.parent.user?this.parent.user.auth:"";w.post(l+"/site/actionStatistic?auth="+u,e).then(function(o){const p=t.$refs.header?.$refs?.msg;if(o.data.error)return p&&p.alertFun(o.data.error),!1;if(p){const c=t.parent.formData.id?"Successfully updated banner!":"Successfully added new banner!";p.successFun(c)}t.get()}).catch(function(o){console.log("errors: ",o)})},copy:async function(t){if(navigator&&navigator.clipboard){await navigator.clipboard.writeText(t);const e=this.$refs.header?.$refs?.msg;e&&e.successFun("Successfully copied!"),this.$refs.copy&&(this.$refs.copy.active=0),this.parent.formData={}}else{const e=this.$refs.header?.$refs?.msg;e&&e.alertFun("Use https!")}}}},U={class:"page-container"},N={key:0,id:"spinner"},B=["src"],H={class:"content-wrapper"},O={class:"toolbar"},A={class:"toolbar-center"},G={class:"date-group"},q={class:"toolbar-right"},z={key:0,class:"ac"},E=["src"],Y={class:"form-container"},J={key:0},K={class:"form-group"},Q={class:"form-group"},R=["value"],W={class:"form-actions"},X={key:0,class:"table-container"},Z={class:"data-table"},j={class:"col-toggle"},x=["onClick"],tt=["src"],et={class:"col-title","data-label":"Campaign"},at={class:"col-link","data-label":"Link"},st={class:"col-stat","data-label":"Views"},ot={class:"col-stat","data-label":"Clicks"},nt={class:"col-stat","data-label":"Leads"},rt={class:"col-stat","data-label":"Fraud"},it={key:1,class:"empty-state"};function lt(t,e,i,l,u,o){const p=g("Header"),c=g("Popup"),C=g("Toogle");return r(),n("div",U,[f(p,{ref:"header"},null,512),t.loader?(r(),n("div",N,[a("img",{src:t.loaderImg,alt:"Loading..."},null,8,B)])):h("",!0),a("div",H,[a("div",O,[e[11]||(e[11]=a("div",{class:"toolbar-left"},[a("h1",{class:"page-title"},"Statistics")],-1)),a("div",A,[a("div",G,[m(a("input",{type:"date",class:"date-input","onUpdate:modelValue":e[0]||(e[0]=s=>t.date=s),onChange:e[1]||(e[1]=s=>o.get())},null,544),[[y,t.date]]),e[9]||(e[9]=a("span",{class:"date-separator"},"-",-1)),m(a("input",{type:"date",class:"date-input","onUpdate:modelValue":e[2]||(e[2]=s=>t.date2=s),onChange:e[3]||(e[3]=s=>o.get())},null,544),[[y,t.date2]])])]),a("div",q,[a("a",{href:"#",class:"btn-primary",onClick:e[4]||(e[4]=D(s=>{t.parent.formData.copy=t.data.multi,t.$refs.copy.active=1},["prevent"]))},[...e[10]||(e[10]=[a("i",{class:"fas fa-images"},null,-1),_(" Multi banners ",-1)])])])]),f(c,{ref:"img",title:"Banner"},{default:b(()=>[t.parent.formData&&t.parent.formData.img?(r(),n("div",z,[a("img",{src:t.parent.url+"/"+t.parent.formData.img,style:{"max-width":"100%","border-radius":"8px"}},null,8,E)])):h("",!0)]),_:1},512),f(c,{ref:"copy",title:"Copy banner"},{default:b(()=>[a("div",Y,[t.parent.formData?(r(),n("form",J,[a("div",K,[e[12]||(e[12]=a("label",null,"Code",-1)),m(a("textarea",{class:"text-input",style:{height:"120px","font-family":"monospace"},"onUpdate:modelValue":e[5]||(e[5]=s=>t.parent.formData.copy=s)},null,512),[[y,t.parent.formData.copy]])]),a("div",Q,[e[14]||(e[14]=a("label",null,"Type",-1)),m(a("select",{class:"text-input","onUpdate:modelValue":e[6]||(e[6]=s=>t.type=s),onChange:e[7]||(e[7]=s=>o.get()),required:""},[e[13]||(e[13]=a("option",{value:"0"},"---",-1)),(r(!0),n(k,null,$(t.data.types,s=>(r(),n("option",{key:s.id,value:s.id},d(s.title),9,R))),128))],544),[[F,t.type]])]),a("div",W,[a("button",{class:"btn-primary",onClick:e[8]||(e[8]=D(s=>o.copy(t.parent.formData.copy),["prevent"]))}," Copy code ")])])):h("",!0)])]),_:1},512),t.data.items&&t.data.items.length>0?(r(),n("div",X,[a("table",Z,[e[15]||(e[15]=a("thead",null,[a("tr",null,[a("th",{class:"col-toggle"}),a("th",{style:{width:"80px"}},"Img"),a("th",null,"Campaign"),a("th",null,"Link"),a("th",{class:"col-stat"},"Views"),a("th",{class:"col-stat"},"Clicks"),a("th",{class:"col-stat"},"Leads"),a("th",{class:"col-stat"},"Fraud")])],-1)),a("tbody",null,[(r(!0),n(k,null,$(t.data.items,s=>(r(),n("tr",{key:s.id},[a("td",j,[f(C,{modelValue:s.published,"onUpdate:modelValue":v=>{s.published=v,t.parent.formData=s,o.actionStatistic()}},null,8,["modelValue","onUpdate:modelValue"])]),a("td",null,[a("div",{class:"mini-preview",onClick:v=>{t.parent.formData=s,t.$refs.img.active=1}},[a("img",{src:s.img?t.parent.url+"/"+s.img:"",style:{cursor:"pointer"}},null,8,tt)],8,x)]),a("td",et,d(s.campaign_title),1),a("td",at,d(s.link),1),a("td",st,d(s.views),1),a("td",ot,d(s.clicks||0),1),a("td",nt,d(s.leads||0),1),a("td",rt,[a("span",{class:V({"text-danger":s.fclicks>0})},d(s.fclicks||0),3)])]))),128))])])])):t.loader?h("",!0):(r(),n("div",it," No statistics found for selected period "))])])}const ft=S(P,[["render",lt],["__scopeId","data-v-b9b75bd9"]]);export{ft as default};
