import{_ as T,c as d,a as f,d as m,b as s,r as _,w as g,g as y,e as w,v as D,h as k,F as I,i as A,f as V,o as h,t as p}from"./index-BgEqfRQl.js";import{T as B,H as L,_ as U,C as E}from"./loader-ZuzIKXJj.js";import{P}from"./Msg-ClLLyrs6.js";const S={name:"Campaigns",components:{Header:L,Popup:P,Toogle:B},data(){return{parent:{formData:{},user:{auth:""},url:""},data:{items:[]},details:{},date:"",date2:"",q:"",sort:"",loader:1,iChart:-1,id:0,type:0,all:!0}},mounted(){const a=this.findParent();a?this.parent=a:console.warn("Родительский компонент не найден, работаем с заглушкой"),this.parent.user&&!this.parent.user.auth&&typeof this.parent.logout=="function"&&this.parent.logout(),this.get()},methods:{findParent(){let a=this.$parent;for(;a;){if(a.url||a.user&&a.user.auth)return a;a=a.$parent}return this.$root&&(this.$root.url||this.$root.user)?this.$root:null},toFormData(a){const t=new FormData;if(!a)return t;for(let r in a)t.append(r,a[r]);return t},get(){this.parent.formData||(this.parent.formData={});const a=new FormData;this.date&&a.append("date",this.date),this.date2&&a.append("date2",this.date2),this.q&&a.append("q",this.q),this.sort&&a.append("sort",this.sort),this.loader=1;const t=this.parent.url||"",r=this.parent.user&&this.parent.user.auth?this.parent.user.auth:"";if(!t){console.log("URL API не найден"),this.loader=0;return}V.post(`${t}/site/getCampaigns?auth=${r}`,a).then(o=>{this.data=o.data,this.loader=0}).catch(o=>{console.error(o),this.parent&&typeof this.parent.logout=="function"&&this.parent.logout(),this.loader=0})},getChart(){if(this.iChart===-1||!this.data.items||!this.data.items[this.iChart])return;let a=this.data.items[this.iChart];this.parent.formData=a;const t=this.toFormData(this.parent.formData);this.date&&t.append("date",this.date),this.date2&&t.append("date2",this.date2);const r=this.parent.url||"",o=this.parent.user?this.parent.user.auth:"";V.post(r+"/site/getCampaignBannersChart?auth="+o,t).then(e=>{let n=e.data.items?e.data.items:e.data;n&&(n.line&&(this.data.items[this.iChart].line=n.line),n.sites&&(this.data.items[this.iChart].sites=n.sites),n.clicks!==void 0&&(this.data.items[this.iChart].clicks=n.clicks),n.views!==void 0&&(this.data.items[this.iChart].views=n.views),n.leads!==void 0&&(this.data.items[this.iChart].leads=n.leads)),this.renderChart(this.data.items[this.iChart])}).catch(e=>{console.log("Chart error",e)})},line(a){this.$nextTick(()=>{document.getElementById("chartOuter")?this.getChart():console.error("Element #chartOuter not found")})},renderChart(a){const t=this;window.myLineChart&&window.myLineChart.destroy(),this.$nextTick(()=>{const r=document.getElementById("chartOuter");if(!r)return;let o=[],e=[],n=[],c=new Date(t.date),v=new Date(t.date2);if(!isNaN(c)&&!isNaN(v))for(;c<=v;){let u=c.getFullYear(),l=("0"+(c.getMonth()+1)).slice(-2),F=("0"+c.getDate()).slice(-2),H=`${F}.${l}.${u}`,N=`${u}-${l}-${F}`;o.push(`${F}.${l}.${u}`);let b=null;a&&a.line&&(b=a.line[H]||a.line[N]),b?(e.push(parseInt(b.clicks)||0),n.push(parseInt(b.views)||0)):(e.push(0),n.push(0)),c.setDate(c.getDate()+1)}document.getElementById("chartHints")||(r.innerHTML=`
            <div id="chartHints" style="display: flex; gap: 10px; justify-content: center; margin-bottom: 10px;">
                <div class="chartHintsViews" style="color: #5000B8; font-weight: bold;">Views</div>
                <div class="chartHintsClicks" style="color: #00599D; font-weight: bold;">Clicks</div>
            </div>
            <div style="height: 300px; position: relative;">
                <canvas id="myChart"></canvas>
            </div>`);const C=document.getElementById("myChart");if(!C)return;const i={id:"xScaleImage",afterDatasetsDraw(u){}};window.myLineChart=new E(C,{type:"line",plugins:[i],data:{labels:o,datasets:[{label:"Clicks",backgroundColor:"#00599D",borderColor:"#00599D",data:e,yAxisID:"y",tension:.1},{label:"Views",backgroundColor:"#5000B8",borderColor:"#5000B8",data:n,yAxisID:"y2",tension:.1}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{type:"linear",display:!0,position:"right",beginAtZero:!0},y2:{type:"linear",display:!0,position:"left",beginAtZero:!0,grid:{drawOnChartArea:!1}}}}})})},checkAll(a){if(this.iChart===-1||!this.data.items[this.iChart])return;const t=this.data.items[this.iChart];t&&t.sites&&Object.values(t.sites).forEach(r=>{r.include=a}),this.parent.formData=t,this.getChart()},action(){if(!this.parent.formData)return;this.parent.formData.copy="";const a=this.toFormData(this.parent.formData),t=this.parent.url||"",r=this.parent.user?this.parent.user.auth:"";V.post(t+"/site/actionCampaign?auth="+r,a).then(o=>{this.$refs.new&&(this.$refs.new.active=0),this.$refs.header&&this.$refs.header.$refs.msg&&(this.parent.formData.id?this.$refs.header.$refs.msg.successFun("Successfully updated campaign!"):this.$refs.header.$refs.msg.successFun("Successfully added new campaign!")),this.get()}).catch(o=>{console.log("errors",o)})},async del(a){if(this.parent.formData=a,this.$refs.header&&this.$refs.header.$refs.msg&&await this.$refs.header.$refs.msg.confirmFun("Please confirm next action","Do you want to delete this campaign?")){const t=this.toFormData(this.parent.formData),r=this.parent.url||"",o=this.parent.user?this.parent.user.auth:"";V.post(r+"/site/deleteCampaign?auth="+o,t).then(e=>{e.data.error?this.$refs.header.$refs.msg.alertFun(e.data.error):(this.$refs.header.$refs.msg.successFun("Successfully deleted campaign!"),this.get())}).catch(e=>{console.log("errors",e)})}},getDetails(a,t){console.log("Get details for:",a,"Type:",t)},openDetails(a,t){this.$refs.details.active=1,this.getDetails(a,t)}}},O={class:"page-container"},q={key:0,id:"spinner"},M={class:"content-wrapper"},R={class:"toolbar"},j={class:"toolbar-left"},Z={class:"toolbar-center"},z={class:"flex panel",style:{display:"flex","justify-content":"space-between",padding:"20px"}},G={class:"w30 ptb25"},Y={class:"w70-al",style:{"flex-grow":"1","padding-left":"20px"}},J={class:"flex cubes",style:{display:"flex",gap:"20px","text-align":"center"}},K={class:"w30 clicks"},Q={class:"w38 views"},W={class:"w30 leads"},X={class:"w38-ctr"},$={class:"flex body",style:{display:"flex","margin-top":"20px"}},tt={class:"w30 ar filchart",style:{width:"30%","border-right":"1px solid #eee","padding-right":"10px"}},et={key:0,class:"itemchart ptb10",style:{padding:"5px 0"}},st={style:{"font-size":"13px"}},it={class:"form-container"},at={class:"form-group"},nt={class:"form-actions"},rt={key:0,class:"btn-primary"},lt={key:1,class:"btn-primary"},ot={key:0,class:"table-container"},dt={class:"data-table"},ht={class:"col-id"},pt={class:"col-toggle"},ct={class:"col-title"},ut={class:"col-stat"},ft=["onClick"],mt={class:"col-stat"},gt=["onClick"],vt={class:"col-stat"},yt=["onClick"],Ct={class:"col-stat"},wt=["onClick"],Dt={class:"col-actions"},kt=["onClick"],xt=["onClick"],bt={key:1,class:"empty-state"},_t={class:"popup-content"};function Vt(a,t,r,o,e,n){const c=_("Header"),v=_("Toogle"),x=_("Popup"),C=_("router-link");return h(),d("div",O,[f(c,{ref:"header"},null,512),e.loader?(h(),d("div",q,[...t[14]||(t[14]=[s("img",{src:U,alt:"Loading..."},null,-1)])])):m("",!0),s("div",M,[s("div",R,[s("div",j,[s("a",{class:"btn-primary",href:"#",onClick:t[0]||(t[0]=g(i=>{e.parent.formData={},a.$refs.new.active=1},["prevent"]))},[...t[15]||(t[15]=[s("i",{class:"fas fa-plus"},null,-1),y(" New ",-1)])])]),s("div",Z,[w(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>e.date=i),onChange:t[2]||(t[2]=i=>n.get()),class:"date-input"},null,544),[[D,e.date]]),t[16]||(t[16]=s("span",{class:"date-separator"},"—",-1)),w(s("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=i=>e.date2=i),onChange:t[4]||(t[4]=i=>n.get()),class:"date-input"},null,544),[[D,e.date2]])]),t[17]||(t[17]=s("div",{class:"toolbar-right"},[s("h1",{class:"page-title"},"Campaigns")],-1))]),f(x,{ref:"chart",fullscreen:"true",title:"Chart"},{default:k(()=>[s("div",z,[s("div",G,[w(s("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=i=>e.date=i),onChange:t[6]||(t[6]=i=>n.getChart()),class:"date-input"},null,544),[[D,e.date]]),w(s("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=i=>e.date2=i),onChange:t[8]||(t[8]=i=>n.getChart()),class:"date-input"},null,544),[[D,e.date2]])]),s("div",Y,[s("div",J,[s("div",K,[t[18]||(t[18]=s("div",{style:{"font-weight":"bold",color:"#00599d"}},"Clicks",-1)),y(" "+p(e.data.items&&e.data.items[e.iChart]?e.data.items[e.iChart].clicks:0),1)]),s("div",Q,[t[19]||(t[19]=s("div",{style:{"font-weight":"bold",color:"#5000b8"}},"Views",-1)),y(" "+p(e.data.items&&e.data.items[e.iChart]?e.data.items[e.iChart].views:0),1)]),s("div",W,[t[20]||(t[20]=s("div",null,"Leads",-1)),y(" "+p(e.data.items&&e.data.items[e.iChart]?e.data.items[e.iChart].leads:0),1)]),s("div",X,[t[21]||(t[21]=s("div",null,"CTR",-1)),y(" "+p(e.data.items&&e.data.items[e.iChart]&&e.data.items[e.iChart].views>0?(e.data.items[e.iChart].clicks*100/e.data.items[e.iChart].views).toFixed(2):"0.00")+"% ",1)])])])]),s("div",$,[s("div",tt,[e.data.items&&e.data.items[e.iChart]&&e.data.items[e.iChart].sites?(h(),d("div",et,[f(v,{modelValue:e.all,"onUpdate:modelValue":[t[9]||(t[9]=i=>e.all=i),t[10]||(t[10]=i=>{e.all=i,n.checkAll(i)})]},null,8,["modelValue"]),t[22]||(t[22]=s("strong",null,"ALL",-1))])):m("",!0),t[23]||(t[23]=s("hr",{style:{border:"0","border-top":"1px solid #eee",margin:"10px 0"}},null,-1)),e.data.items&&e.data.items[e.iChart]?(h(!0),d(I,{key:1},A(e.data.items[e.iChart].sites,(i,u)=>(h(),d("div",{class:"itemchart ptb10",style:{padding:"5px 0",display:"flex","align-items":"center",gap:"10px"},key:i.site||u},[f(v,{modelValue:i.include,"onUpdate:modelValue":[l=>i.include=l,t[11]||(t[11]=l=>{e.parent.formData=e.data.items[e.iChart],n.getChart()})]},null,8,["modelValue","onUpdate:modelValue"]),s("span",st,p(i.site),1)]))),128)):m("",!0)]),t[24]||(t[24]=s("div",{class:"w70",id:"chartOuter",style:{width:"70%","padding-left":"20px"}},[s("div",{id:"chartHints",style:{display:"flex",gap:"10px","justify-content":"center","margin-bottom":"10px"}},[s("div",{class:"chartHintsViews",style:{color:"#5000b8","font-weight":"bold"}}," Views "),s("div",{class:"chartHintsClicks",style:{color:"#00599d","font-weight":"bold"}}," Clicks ")]),s("div",{style:{height:"300px",position:"relative"}},[s("canvas",{id:"myChart"})])],-1))])]),_:1},512),f(x,{ref:"new",title:e.parent.formData&&e.parent.formData.id?"Edit campaign":"New campaign"},{default:k(()=>[s("div",it,[e.parent.formData?(h(),d("form",{key:0,onSubmit:t[13]||(t[13]=g(i=>n.action(),["prevent"]))},[s("div",at,[t[25]||(t[25]=s("label",null,"Name",-1)),w(s("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=i=>e.parent.formData.title=i),required:"",placeholder:"Enter campaign name...",class:"text-input"},null,512),[[D,e.parent.formData.title]])]),s("div",nt,[e.parent.formData&&e.parent.formData.id?(h(),d("button",rt," Save Changes ")):m("",!0),e.parent.formData&&!e.parent.formData.id?(h(),d("button",lt," Add Campaign ")):m("",!0)])],32)):m("",!0)])]),_:1},8,["title"]),e.data.items&&e.data.items.length>0?(h(),d("div",ot,[s("table",dt,[t[29]||(t[29]=s("thead",null,[s("tr",null,[s("th",{class:"col-id"},"#"),s("th",{class:"col-toggle"},"Status"),s("th",null,"Title"),s("th",{class:"col-stat"},"Views"),s("th",{class:"col-stat"},"Clicks"),s("th",{class:"col-stat"},"Leads"),s("th",{class:"col-stat"},"Fraud"),s("th",{class:"col-actions"},"Actions")])],-1)),s("tbody",null,[(h(!0),d(I,null,A(e.data.items,(i,u)=>(h(),d("tr",{key:i.id||u},[s("td",ht,p(i.id),1),s("td",pt,[f(v,{modelValue:i.published,"onUpdate:modelValue":[l=>i.published=l,l=>{e.parent.formData=i,n.action()}]},null,8,["modelValue","onUpdate:modelValue"])]),s("td",ct,[f(C,{to:"/campaign/"+i.id,class:"link-primary"},{default:k(()=>[y(p(i.title),1)]),_:2},1032,["to"])]),s("td",ut,[s("a",{href:"#",onClick:g(l=>n.openDetails(i.id,1),["prevent"])},p(i.views),9,ft)]),s("td",mt,[s("a",{href:"#",onClick:g(l=>n.openDetails(i.id,2),["prevent"])},p(i.clicks||0),9,gt)]),s("td",vt,[s("a",{href:"#",onClick:g(l=>n.openDetails(i.id,3),["prevent"])},p(i.leads||0),9,yt)]),s("td",Ct,[s("a",{href:"#",onClick:g(l=>n.openDetails(i.id,4),["prevent"])},p(i.fclicks||0),9,wt)]),s("td",Dt,[f(C,{to:"/campaign/"+i.id,style:{"margin-right":"8px",color:"#888"}},{default:k(()=>[...t[26]||(t[26]=[s("i",{class:"fas fa-edit"},null,-1)])]),_:1},8,["to"]),s("a",{href:"#",onClick:g(l=>{e.parent.formData=i,e.iChart=u,a.$refs.chart.active=1,n.line(i)},["prevent"]),style:{"margin-right":"8px",color:"#888"}},[...t[27]||(t[27]=[s("i",{class:"fas fa-chart-bar"},null,-1)])],8,kt),s("a",{href:"#",onClick:g(l=>{e.parent.formData=i,n.del(i)},["prevent"]),class:"icon-delete"},[...t[28]||(t[28]=[s("i",{class:"fas fa-trash-alt"},null,-1)])],8,xt)])]))),128))])])])):m("",!0),!e.data.items||e.data.items.length===0?(h(),d("div",bt," No items found ")):m("",!0)]),f(x,{ref:"details",title:"Campaign Details"},{default:k(()=>[s("div",_t,[t[30]||(t[30]=s("p",null,"Details for campaign loaded in console.",-1)),s("pre",null,p(e.details),1)])]),_:1},512)])}const Ht=T(S,[["render",Vt],["__scopeId","data-v-18929f60"]]);export{Ht as default};
